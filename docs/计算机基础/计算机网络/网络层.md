# 网络层概述

- 网络层的主要任务：**实现网络互连**，从而实现数据包在**各网络之间的传输**（主要靠路由器实现）
- 网络层需要解决以下主要问题：
  1. **网络层向运输层提供怎样的服务**（可靠传输 / 不可靠传输）
  2. **网络层寻址问题**
  3. **路由选择问题**
- 因特网使用的是 TCP / IP 协议栈
- TCP / IP 协议栈的网络层使用**网际协议 IP**，它是整个协议栈的核心协议，因此 TCP / IP 协议栈中的网络层常称为**网际层**

![TCP/IP协议栈](pics/image-20211027095203662.png)

# 网络层提供的两种服务

## 面向连接的虚电路

- 可靠通信由**网络**来保证
- **必须建立网络层的连接 —— 虚电路 VC（Virtual Circuit）**
- **通信双方沿着已建立的虚电路发送分组**
- 目的主机的地址仅在连接建立阶段使用，**之后每个分组的首部只需携带一条虚电路的编号**
- 该通信方式可使所发送的**分组最终正确到达接收方（无差错按序到达、不丢失、不重复）**
- **通信结束后，需要释放之前所建立的虚电路**

![面向连接的虚电路](pics/image-20211027100018322.png)

- **很多广域分组交换网**都使用面向连接的虚电路服务

## 无连接的数据报服务

- 可靠通信由**用户主机**来保证
- **不需要建立网络层连接**
- **每个分组可走不同的路径**
- 每个分组的**首部必须携带目的主机的完整地址**
- 该通信方式所传送的**分组可能误码、丢失、重复和失序**
- 由于**网络本身不提供端到端的可靠传输服务**，使得路由器结构简单、成本低廉
- **因特网**采用该通信方式，即**将复杂的网络处理功能置于因特网的边缘（用户主机和其内部的运输层）**，将相对简单的分组交付功能置于因特网核心
  - **TCP / IP 体系结构的因特网的网际层提供的是简单灵活、无连接的、尽最大能力交付的数据报服务**

![无连接的数据报服务](pics/image-20211027100756111.png)

## 两种服务的对比

|              | 虚电路服务                                     | 数据报服务                                     |
| ------------ | ---------------------------------------------- | ---------------------------------------------- |
| 思路         | 可靠通信由网络来保证                           | 可靠通信由用户主机来保证                       |
| 连接建立     | 必须建立网络层连接                             | 不需要建立网络层连接                           |
| 终点地址     | 仅在连接建立阶段使用，每个分组使用短的虚电路号 | 每个分组都有终点的完整地址                     |
| 分组转发     | 属于同一条虚电路的分组均按照同一路由进行转发   | 每个分组可走不同的路由                         |
| 结点故障     | 所有通过故障结点的虚电路均不能工作             | 故障结点可能会丢失分组，一些路由可能会发生变化 |
| 分组顺序     | 总是按发送顺序到达                             | 不一定按发送顺序到达                           |
| 服务质量保证 | 可将通信资源提前分配给每一个虚电路，容易实现   | 很难实现                                       |

# IPv4 地址









